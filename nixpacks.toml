[nixpkgs]
packages = ["nodejs_22", "npm"]

[phases.setup]
aptPkgs = [
    "php8.3",
    "php8.3-fpm",
    "php8.3-cli",
    "php8.3-mysql",
    "php8.3-xml",
    "php8.3-mbstring",
    "php8.3-curl",
    "php8.3-zip",
    "php8.3-intl",
    "php8.3-bcmath",
    "composer",
    "nginx"
]

[phases.build]
cmds = [
    "npm ci",
    "npm run build",
    "php artisan key:generate",
    "php artisan storage:link",
    "php artisan optimize"
]

[start]
cmd = "php artisan serve --host=0.0.0.0 --port=8080"
